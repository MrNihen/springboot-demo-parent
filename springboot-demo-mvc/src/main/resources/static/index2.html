<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>mybatis+springboot+mvc+BS+Vue</title>
    <style>
        .panel-title {
            padding: 12px 0;
        }

        .table {
            text-align: center;
        }

    </style>
    <!--1.引入bs的css样式-->
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
    <!--2.引入jquery-->
    <script src="node_modules/jquery/jquery.min.js"></script>
    <!--3.引入bs的js库-->
    <script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <!--4.引入vue库-->
    <script src="node_modules/vue/vue.min.js"></script>
    <!--5.引入axios库-->
    <script src="node_modules/axios/axios.min.js"></script>
</head>
<body>
<div class="container">
    <div class="page-header">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">学生列表[mybatis+springboot+mvc+BS+Vue]{{new Date()}}</h3>
                {{selectIds}}
            </div>
            <table class="table table-bordered table-hover">
                <tr class="bg-info">
                    <td>是否删除</td>
                    <td>学号</td>
                    <td>姓名</td>
                    <td>性别</td>
                    <td>年龄</td>
                    <td>住址</td>
                    <td>所在班级</td>
                    <td>操作</td>
                </tr>
<!--                //v-for代表循环数组或者集合-->
                <tr v-for="stud in students">
                    <td>
                        <input type="checkbox" v-model="selectIds" :value="stud.sid">
                    </td>
                    <td>{{stud.sid}}</td>
                    <td>{{stud.sname}}</td>
                    <td>{{stud.sex}}</td>
                    <td>{{stud.age}}</td>
                    <td>{{stud.addr}}</td>
                    <td>{{stud.cname}}</td>
                    <td>
                        <a href="#" class="btn btn-success" @click="updateUI(stud)">修改</a>
                    </td>
                </tr>
                共{{totalPage}}页{{total}}条
                <tr>
                    <td colspan="7">
                        <nav aria-label="Page navigation">
                            <ul class="pagination">
                                <li>
                                    <a href="#" aria-label="Previous" @click="skipPage2(page-1)">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>
                                <li v-for="p in totalPage" :class="{active:p==page}">
                                    <a href="#" @click="skipPage(p)">{{p}}</a>
                                </li>
                                <li>
                                    <a href="#" aria-label="Next" @click="skipPage2(page+1)">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                                <li>
                                    <select class="form-control" v-model="pageSize" @click="search(page)">
<!--                                        <option value="0">5</option>-->
                                        <option v-for="(item,index) in pageSize2" :value="item">{{item}}</option>
                                    </select>

                                </li>
                            </ul>
                        </nav>
                    </td>
                </tr>
            </table>
            <div class="panel-footer text-left">
                <form  class="form-inline" >
                    <div class="form-group">
                        <input type="text" class="form-control" v-model="studentEntity.sname"
                               placeholder="要查询的学生姓名">
                        <input type="text" class="form-control" v-model="studentEntity.addr"
                               placeholder="要查询的学生住址">

                        <select v-model="studentEntity.cid" class="form-control">
                            <option value="0">所在班级</option>
<!--                            <lable>所在班级</lable>-->
                            <option v-for="c in classes" :value="c.cid">{{c.cname}}</option>
                        </select>
                        <a href="#" class="btn btn-default btn-sm" @click="search(1)">查询</a>

                    </div>
                    <div class="text-right">
                        <a class="btn btn-primary btn-sm" data-toggle="modal" href="#studModal"
                           @click="studentEntity={}">添加学生</a>
                        <a class="btn btn-danger btn-sm" @click="dele()">删除学生</a>
                        泽林教育.
                    </div>

                </form>

            </div>

        </div>
    </div>
    <div class="modal fade" id="studModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">保存学生</h4>
                </div>
                {{studentEntity}}
                <div class="modal-body">
                    <form class="form-horizontal" id="form1">
                        <input type="hidden" name="sid" id="sid">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">学生姓名</label>
                            <div class="col-sm-10">
                                <input type="text" v-model="studentEntity.sname" class="form-control" placeholder="姓名">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">学生性别</label>
                            <div class="col-sm-10">
                                <div class="radio">
                                    <label>
                                        <input type="radio" v-model="studentEntity.sex" value="男">男
                                    </label>
                                    <label>
                                        <input type="radio" v-model="studentEntity.sex" value="女">女
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">学生年龄</label>
                            <div class="col-sm-10">
                                <input type="text" v-model="studentEntity.age" class="form-control" placeholder="年龄">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">学生住址</label>
                            <div class="col-sm-10">
                                <input type="text" v-model="studentEntity.addr" class="form-control" placeholder="住址">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">所在班级</label>
                            <div class="col-sm-10">
                                <select v-model="studentEntity.cid" class="form-control">
<!--                                    <option disabled value="0">所有班级</option>-->
                                    <option v-for="c in classes" :value="c.cid">{{c.cname}}</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" @click="save()">保存</button>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
<script>
    let vs = new Vue({
        el:'.container',
        data:{
            students:[],
            classes:[],
            selectIds:[],
            studentEntity:{},
            pageSize: 10,            //每页大小
            pageSize2:[5,10,20,40,50,100],
            totalPage:0,            //总页数
            page:1,                 //当前页
            total:0,
            selected:''
        },
        mounted(){
            // //1.查询所有学生
            // this.findStudents();
            //2.查询所有班级
            this.findClasses();
            //3.条件带分页查询
            this.search(1);
        },
        methods:{
            // //1.查询所有学生
            // findStudents(){
            //     axios.get("/student/list").then(resp=>{
            //         this.students = resp.data.data;
            //         console.log(resp.data.data);
            //     })
            // },
            //2.查询班级
            findClasses(){
                axios.get("/classes/list").then(resp=>{
                    this.classes = resp.data.data;
                    console.log(resp.data.data);
                })
            },
            //3.保存学生
            save(){
                //3.1)根据this.studentEntity.sid是否有值决定是添加还是修改
                let url = "/student/add";
                if(this.studentEntity.sid){
                    url = "/student/update";
                }
                //3.2)向后台发出请求
                axios.post(url,this.studentEntity).then(resp=>{
                    if(resp.data.success){
                        //3.2.1)刷新页面
                        this.search(1);
                        //3.2.2)关闭对话框
                        $(".modal").modal("hide");
                    }else{
                        alert(resp.data.message);
                    }
                })
            },
            //4.修改学生界面
            updateUI(stud){
                //4.1)为this.studentEntity赋值
                this.studentEntity = stud;
                //4.2)打开窗口
                $(".modal").modal("show");
            },
            //5.删除学生
            dele(){
                if(confirm("真要删除吗?")){
                    axios.post("/student/delete?ids=" + this.selectIds).then(resp=>{
                        if(resp.data.success){
                            //3.2.1)刷新页面
                            this.search(1);
                            //3.2.2)关闭对话框
                            $(".modal").modal("hide");
                        }else{
                            alert(resp.data.message);
                        }
                    })
                }
            },

            //3.点击页码按钮跳转到某一页
            skipPage(p){
                //3.1)开始分页查询
                //this.findByPage(p);
                //3.2)条件查询带分页
                    this.search(p);
            },
            //上一页下一页调用的方法
            skipPage2(p){
                //3.1)开始分页查询
                //this.findByPage(p);
                //3.2)条件查询带分页
                if (p >= 1 && p <= this.totalPage ){
                    this.search(p);
                }
            },
            //4.条件查询学生信息并分页
            search(page){

                axios.post("/student/search?page="+page+"&pageSize="+this.pageSize,this.studentEntity).then(resp=>{
                    //4.1)得到当前页学生列表:第一个data是vue获取到的后端json自定义统一复杂结果集，第二个data是后端返回的Json对相关里的一个小对象取值
                    this.students = resp.data.data.rows;
                    //4.2)得到总页数
                    this.totalPage = resp.data.data.totalPage;
                    //4.3)设置当前页
                    this.page = resp.data.data.page;
                    //这里默认下拉框为0，显示所有班级
                    this.total = resp.data.data.total;

                })
            },


        }
    })
</script>
